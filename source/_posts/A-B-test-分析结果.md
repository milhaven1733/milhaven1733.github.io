---
title: A/B test 分析结果
date: 2017-06-08 10:43:12
tags:
categories: 数据分析
---

#### 概述

针对实验结果作出分析，从采集的数据中得出结论。

- Sanity checks
- single metric
- multiple metric
- gotchas（陷阱）

#### 健全性检查

在得到实验结果之前，需要进行健全性检查确保已恰当的完成了实验。

可能导致实验结果无效的环节：

- 实验分配错误导致实验组与对照组无法进行对比。
- 对于实验组和对照组采用了额不同的筛选条件
- 没有采集到目标对象的事件

如何测试：

- 检查基于分组单元的不变量——总体规模指标

  检查实验组和对照组的总体规模是否具有可比性

- 检查实际不变量（是否没有发生变化）

#### choose invariant metrics

![](A-B-test-分析结果\1.png)

在第一个案例中：

分组单元为user-id，登录用户可以随机分配给实验组和对照组，是较好的总体规模指标

cookie和event不能直接随机化，但可以最终被平均分配，作为总体规模指标

由于用户需要先点击“start now”按钮才能查看课表，按钮点击率不受变更影响，是一个实际不变量指标。

但完成课程的时间会受课表排列顺序更改的影响，不适合作为不变量

对于第二个案例：

分组单元为event，event作为总体规模指标可以被随机分配。

user-id、cookie大于分组单元，根据分组单元分配的随机性，两组user-id和cookie数量也不应有所差别

第四项理由同上

由于event随机分配，无法追踪课程完成时间，即使可以追踪，也会受视频加载时间影响，不适合作为不变量

案例三：更改登录按钮位置（从选择课程页面提示登录，到将按钮添加在每个页面上），查看用户的登录

![](A-B-test-分析结果\2.png)

分组单元为cookie，user-id，cookie、event都应该保证总体规模不变

由于用户登录后可能直接进入课程页面，从而对开始按钮点击率产生影响，不属于实际不变量

登录率是实验中想要更改的指标，而登录率改变也可能影响课程的注册率，所以两者都不属于不变量

视频加载时间与后台变化有关，本次实验中未更改，是较好的不变量

#### check invariants 检查不变量

如某一分组单元为cookie的实验进行了两周，首先要进行的不变量检查是对照组中的cookie数量是否大致接近实验组中的数量，总体统计如下：

![](A-B-test-分析结果\3.png)

如果每条cookie的记录都以0.5的概率随机分配进两个组，那么对照组与实验组cookie数量的差异是否在预料之内？

概率分布问题通过构建二项式置信区间来解决：

- 计算成功率为0.5的二项分布的标准差
- SD*置信度Z值得到误差范围
- 计算置信区间（若实验设置合理，实验/对照组cookie分配实际概率很可能会落入置信区间）
- 检查观察到的成功率是否落入置信区间

如当前案例中：

$$SD=\sqrt{\frac{p(1-p)}{N}}=\sqrt{\frac{0.5*0.5}{64454+61818}}=0.0014$$

$$m=SD*1.96=0.0027$$

则，0.5之间的置信区间为0.4973～0.5027

$$ 而 \hat p=\frac{64454}{64454+61818}=0.5104$$

说明实验采集设置可能出现了一些问题

可以进一步检查每日数据可以发现是某日的数据异常导致该问题还是整体模式问题

![](A-B-test-分析结果\4.png)

发现大多数日期都出现了异常的比率，说明总体模式存在问题

可以尝试以地区、语言、平台等为标准进行分割，找到造成该问题的部分。



一旦完整性检查失败，如果继续，则结论可能全部出错，必须分析查明失败的原因

- 首先要检查技术问题，如实验架构、实验分组设置问题
- 回顾性分析，从数据采集方面重新对实验分组

常见的原因：

- 数据采集问题
- 两组数据筛选机制不同

#### single metric

针对单一指标，需要制定业务决策判断实验是否对指标产生积极影响：

从实验分析角度，即判断实验结果是否具有统计显著性

- 以指标如何描述和设置实验运行时间、规模等操作为基础，评估差异性、计算显著性

如果实验结果不具有显著性，需要多花时间来分析结果，如：

将实验分到几个不同平台、不同时间段。

如果是第一次评估差异性，可以通过非参数符号检验等特殊方式进行检验，将得到的结果与参数检验的结果进行对比。

#### Simpson‘s paradox

当实验结果出现符号检验结果与假设检验结果不一致，或周末数据具有显著性但工作日时相反应如何处理？

首先观察实验特征，如是否针对不同的平台产生不同作用。

但某些统计因素会导致与正常视觉相反的结果——常见的如“辛普森悖论”

即：数据可分为许多不同小组，每个小组结果单独看稳定，合并考虑时，各小组数据共同对最终结果产生影响。

例如：

