---
title: A/B test 选择和测量指标
date: 2017-05-28 22:36:40
tags:
categories: 数据分析
---

#### 概述

实验指标的创建过程：

- Define [定义一套指标]（从指标的高层概念到数据捕获方面的实际意义）
- Build intuition [建立直觉]（关于指标敏感性和稳健性）
- Characterize [描述]（关于指标差异性）

<!---more--->

#### 指标定义



- invariant（sanity） checking（不变量/完整性检查）指标

如：对比实验组与对照组的总体是否相同，可检查两组中总体的数量或分布是否相同——完整性检查

- evaluation（评估）指标

高级指标（如收益、市场份额、用户量）——>细节指标（用户体验、页面停留时间等）

定义过程：

- 为指标提出高级概念（一句话总结）
- 确定细节（如测试活跃用户，怎样算活跃？）
- 将独立的数据总结为指标的值（如取一些描述统计量）

在评估时，选取一个独立的指标还是一套指标要应需求而定

可将多个指标组合成一个复合指标（或称OEC，overall evaluation criterion 综合评估标准）

但综合指标较难于定义或容易过度优化导致一些指标被忽略

最后，要考虑指标是否普遍适用（generally applicable），理想状况是某个指标适用于A/B test的整套测试过程

#### 难以测量的指标

- 无法访问/获取的数据
- 需要耗费很长时间才能采集到的指标

例如：

- 某在线教育网站学生返回学习第二门课程的比率（收集周期过长）
- 某购物网站的消费者“幸福指数” （难以收集、测量）
- 搜索引擎用户搜索到他们要寻找的信息的概率 （无法获取）

#### 定义指标的技巧

作用：生成新的指标创意、验证已有的指标、深度挖掘用户体验、提供分析和观察技巧

方式：surveys、retrospective analyses（回顾性分析）、focus group（焦点小组）

​	（用于新指标brainstorm或验证可用的指标）

- 外部数据
  - 采集其他细节的数据与用户数据结合
  - 调查用户，从已有来源获取用于营销或其他目的的数据
  - “学术研究”数据。探索关于指标建立的论文等，寻找相关的研究或结果

采集用户附加数据的方法：

维度：数据深度、参与人数

- UER （user experience reserach-用户体验研究）

  对少数用户进行深度研究

  - 有益于brainstorm（提出想法、修改测试、将问题转化为可以用来评估A/B test的指标）
  - 使用特殊实验（如采用眼球追踪摄像头观测用户行为得出无法从网页上获取的数据）
  - 使结果有效化（vaildate result）如回顾性分析

- 焦点小组（focus  group）

  将一群用户或潜在用户组织在一起进行讨论（交流广度加大但深度减小）

  - 可以提出假设性问题，收集反馈
  - 利用群体思维和意见减小风险

- 调查（与更多用户交流得到更具量化性的数据，但深度较弱，或不具有个体自定义性）

  - 对无法直接测量得出的数据很有用

    但注意要小心对待调查结果，不能直接将调查结果和使用观察性方法计算的结果进行比较

#### 技巧示例

上述技巧如何用于验证“用户漏斗”中的指标或漏斗中未涵盖而在头脑风暴中产生的新指标？

- 关于用户访问量和课程完成率

  可以对比页面访问量、课程完成率与其他公司的可用外部指标

  当发现完成率较低，可以进行UER来调查原因（可以观察用户行为发现在某些方面存在需要跟踪、改进的部分）

  在UER阶段，可能会考虑到通过回顾性分析验证一些指标的变化，或实施新的实验看指标随作出变更的变化

- 对于“学员是否找到工作、课程是否有帮助”

  指标无法测量、通过邮件等调查会有所帮助

  但由于内部指标和参与调查人数不匹配，调查获得的数据不能与指标数据直接比较

一些实例：

- 测量学员返回学习第二门课程的比率

  对用户进行调查，如果在调查中找到可测量的指标，可将其用作实验中的替代指标

- 测量用户“幸福”指数

  可以进行弹窗调查或小型UER

- 测试搜索引擎用户找到所需信息的比率

  存在多个替代指标，如：

  - 搜索页面耗时长短
  - 用户是否点击任何结果
  - 是否尝试用不同方法获取正确信息

  也可以采用UER或人工评估

- 测量某课程用户参与度

  - 调查，询问学员如何参与课程，将调查回应作为一个代替指标
  - UER。观察学员如何与课程互动
  - 回顾性分析。查看完成课程学员的共同行为

- 购物网站测试是否需要增加产品

  - 焦点小组
  - 数据（从其他购物网站获取外部数据）

- 某网站测试广告放置位置

  - 外部数据（用页面停留时间、鼠标悬浮事件等作为广告浏览信息的替代指标）
  - UER，观察用户更关注哪些广告，找出相关指标。或使用历史数据评估相对点击量作为浏览量的一个替代指标
  - 回顾性分析

#### 指标定义和数据捕捉

高级概念——>认识充分的定义，要经过：

- 完全准确定义计算指标过程中要查看的数据
- 指标如何概括（计算）

是否真的理解指标中的变更能否由系统产生？（是否能辨别出不现实的变更）

例子：如果计算点击概率？

- 首先判断我们观察的事件中，哪些对该指标有价值，怎样结合这些事件

  （如观察点击总量和网页浏览总量 或查看用户的cookie，访问网页时是否产生点击事件）

其他细节问题

- 数据统计的时间区间。如统计一天的点击概率，访问网页和点击按钮之间跨越了某天的0点，是将两个事件分开还是作为同一天的数据。
- 数据统计的技术问题。如JS pings发送204请求来捕获点击率，但某些浏览器不支持JS或会产生失效率，点击率会因为浏览器、平台不同而产生差别，必须明白差异产生的真正原因

#### 指标定义示例

高级指标：点击概率 $$click-through-probability=\frac{user-who- click}{user-who-visit}$$

如何完全定义：

- 两个事件是否来自同一用户？（可通过cookie判断）
- 可以将同一用户（或cookie）多久内的访问量算作一次（选取时间段）

完全定义1：Cookie 概率 for each time interval $$\frac{cookies-that-clicks}{cookies}$$

完全定义2：网页流量概率 for each time interval $$\frac{pageviews-who -clicks}{pageviews}$$

完全定义3：总点击数除以网页浏览量总数——比例$$\frac{clicks}{pageviews}$$

#### 过滤和分隔

指标筛选：

如果做出的更改只影响部分流量，如影响某个国家或某个平台的流量，或指标只针对部分群体，筛选指标可以使结果更具敏感性、数据不出现偏差。

同时在筛选时，要注意检查确保不是由于网站、指标或日志导致一些怪异的用户行为会话。

如何检查:

切分数据。（在不相交的集合中计算指标）

进行是否筛选指标的分析时，要明确期望或不期望发生的变化，在查看数据时才能发现是否存在问题。

示例：

分隔后，查看数据的各个部分对于评估指标各部分差异很有作用。

如统计总活跃cookie数量随时间变化的趋势，得到过去四周中每天活跃的cookie数量，发现一些固定的周间变化以及一个突出的峰值，为核实峰值的出现是否出于偶然可以用每个数据点除以一周前的对应数据点或除以一年前的对应数据点，如果依然出现显眼的峰值，则说明峰值不是由周内或年内的特定因素下的变化产生的。

此时可以查看群体各部分的该指标，观察峰值在各部分统一出现还是由某一部分造成，确定了问题出现的部分，可以更好地确定异常值是否由异常行为造成。

现在，假设网页中JS的点击跟踪可能有问题（移动端和PC端记录次数不同），怎样的方法可能可以确认该问题是否实际存在？

- 对不同平台分别绘制点击概率和点击率变化图形加以比较

![](A-B-test-选择和测量指标\1.png)

移动端点击概率实际较低但点击率明显更高，说明点击跟踪出现了问题

#### 总指标（summary metrics）

独立事件的总结，如：总访问cookie，进而总结为每周平均访问量等

当事件测量指标为数字时，就产生了一整套供选择的总指标（mean，median，50%，75%）

选择具体描述时，需要考虑其敏感性和稳健性，也要根据指标分布状态来选择描述值

（敏感性：能够在未来测试中发现变更）

常用总指标类型：

- sums/counts
- distribution metrics（mean、median、percentile）
- probabilities /rates
- ratios

#### 敏感性和健壮性

健壮性：当不发生一些有意义的事件时，指标不会发生太大改变。

如：mean容易受异常值影响，健壮性差。

如何测量：

- 进行实验或使用已有实验

  做出更改，查看关注的指标是否做出响应

  或测试未作出修改时，指标是否产生差异

- 对记录进行回顾性分析

  看之前做出更改时指标的变化或直接查看指标历史分析出现变更的原因

示例：

指标：视频加载延迟时长

采用某描述值作为总指标。

- 回顾性分析

  对于具有可比性的几个视频（如大小相等）绘制延迟分布密度曲线，选取不同的总指标，查看变化：

  ![](A-B-test-选择和测量指标\2.png)

  90%、99%分布有波动，不够稳健。

  （当然也需要事先排除导致波动出现的一些潜在因素）

- 利用已有的实验

  利用之前做过的关于调整分辨率的实验绘制密度曲线并查看总指标的变化

  ![](A-B-test-选择和测量指标\3.png)

  median、80%指标未发生我们关心的更改、敏感性差。

#### 偏差：相对？or 绝对？

确定如何计算实验组和对照组之间的比较。

刚建立实验、指标体系时，通常采取差值。

差值存在：

- 绝对变化

- 相对变化（百分比变化）

  优势：

  - 仅需要选择一个随时间趋于稳定的practical significance boundary
  - 指标可能随时间变化，使用相对变化可以保持practical significance boundary不变

  劣势：

  - 差异性

  （对指标不够了解时，尽量使用绝对偏差）

#### 差异性（variability）

从统计学角度对差异性提出更严谨的定义

计算方式：

- 理论计算（对于一些标准的数据，如人口统计数据）得出置信区间

示例：

计算置信区间，首先需要：

- 指标方差（或标准差）
- 指标分布情况

如当指标呈现二项分布

$$SE=\sqrt{\frac{\hat p(1-\hat p)}{N}}$$

N越大，二项分布越趋于正态分布

其他指标分布形式及方差计算：

![](A-B-test-选择和测量指标\4.png)

- 中位数、百分比的分布取决于基础数据分布
- count往往更易于分析，差异通常成正态分布，差异的方差为各变量方差之和
- 概率（比率）通常会呈泊松分布，差异的方差为均值

#### 非参数方法

- 针对难以计算出方差的指标。
- 无需对分布情况作出假设
- 计算可能更复杂，但实用

如：

##### 符号检验

如开展为期二十天的A/B test，前十五天，实验组测量结果均高于对照组，可以通过差异符号检验，用类似二项分布方法来计算结果发生的概率

缺点：

无法估计效应的大小

优点：

操作简单适用性强

如何检测达到实际显著性水平：

- 根据样本数据计算经验方差（数据正态分布时可直接用于计算置信区间）
- 计算非参数置信区间（数据分布不太标准或想要更严谨的分析）

#### 实证差异性

对于指标方差，需要对数据潜在分布作出假设。

对于复杂指标，分布可能会比较离奇，需要对方差empirical estimate而不是通过分析计算。

然而即使是简单指标，对方差的估计还是会出现低估状况。

如何解决：

- 运行多个A/A test

  对比两个对照组，检测内部潜在的差异性

  可用于测试复杂的实验体系

- 运行一个大规模A/A test

  利用统计学中的bootstrap（自助法），将样本随机划分为多个小样本群并进行对比

  对于比较复杂的指标，可以采用bootstrap对比分析估计结果，若不一致，可以考虑运行多个A/A test

#### 关于A/A test

- 已计算置信区间，检查A/A test结果是否符合预期（完整性检查）
- 预测方差，计算置信区间
- 从A/A test结果中直接估计置信区间

