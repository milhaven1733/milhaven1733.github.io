---
title: MySQL-学习笔记-6
date: 2017-04-25 16:40:12
tags:
categories: SQL
---

### 运算符与函数

#### 概述

按照功能划分：

- 字符函数
- 数值运算符和函数
- 比较运算符和函数
- 日期时间函数
- 信息函数
- 聚合函数
- 加密函数

<!---more--->

#### 字符函数

| 函数名称        | 描述             |
| ----------- | -------------- |
| CONCAT()    | 字符连接           |
| CONCAT_WS() | 使用指定的分隔符进行字符连接 |
| FORMAT()    | 数字格式化          |
| LOWER()     | 转换成小写字母        |
| UPPER()     | 转换成大写字母        |
| LEFT()      | 获取左侧字符         |
| RIGHT()     | 获取右侧字符         |
| LENGTH()    | 获取字符串长度        |
| LIRIM()     | 删除前导空格         |
| RTTIM()     | 删除后导空格         |
| TRIM()      | 删除前导和后导空格      |
| SUBSTRING() | 字符串截取          |
| [NOT] LIKE  | 模式匹配           |
| REPLACE()   | 字符串替换          |

##### CONCAT()

连接多个字符串：

```
mysql> SELECT CONCAT('test','CONCAT');
+-------------------------+
| CONCAT('test','CONCAT') |
+-------------------------+
| testCONCAT              |
+-------------------------+
```

```
mysql> SELECT CONCAT('test','-','CONCAT');
+-----------------------------+
| CONCAT('test','-','CONCAT') |
+-----------------------------+
| test-CONCAT                 |
+-----------------------------+
```

连接数据表中的字符串：

```
mysql> SELECT * FROM test2;
+------------+-----------+
| first_name | last_name |
+------------+-----------+
| A          | B         |
| C          | D         |
| tom%       | 123       |
| NULL       | 11        |
+------------+-----------+
mysql> SELECT CONCAT(first_name,last_name) AS fullname FROM test2;
+----------+
| fullname |
+----------+
| AB       |
| CD       |
| tom%123  |
| NULL     |
+----------+
```

##### CONCAT_WS()

连接字符串时使用指定字符来分隔。

```
mysql> SELECT CONCAT_WS('|','A','B','C');
+----------------------------+
| CONCAT_WS('|','A','B','C') |
+----------------------------+
| A|B|C                      |
+----------------------------+
```

```
mysql> SELECT CONCAT_WS('_',first_name,last_name) AS fullname FROM test2;
+----------+
| fullname |
+----------+
| A_B      |
| C_D      |
| tom%_123 |
| 11       |
+----------+
```

##### FORMAT()

将数值格式化为字符型。

```
mysql> SELECT FORMAT(12345.678,2);
+---------------------+
| FORMAT(12345.678,2) |
+---------------------+
| 12,345.68           |
+---------------------+
```

保留两位小数，千位划分。

```
mysql> SELECT FORMAT(12345.678,0);
+---------------------+
| FORMAT(12345.678,0) |
+---------------------+
| 12,346              |
+---------------------+
```

保留整数。

##### LOWER()

将字符串全部转化为小写

```
mysql> SELECT LOWER('MySQL');
+----------------+
| LOWER('MySQL') |
+----------------+
| mysql          |
+----------------+
mysql> SELECT LOWER(first_name) FROM test2;
+-------------------+
| LOWER(first_name) |
+-------------------+
| a                 |
| c                 |
| tom%              |
| NULL              |
+-------------------+
```

##### UPPER()

将字符串全部转化为大写

```
mysql> SELECT UPPER('MySQL');
+----------------+
| UPPER('MySQL') |
+----------------+
| MYSQL          |
+----------------+
```

##### LEFT()

选取字符串左侧n位字符

```
mysql> SELECT LEFT('MySQL',2);
+-----------------+
| LEFT('MySQL',2) |
+-----------------+
| My              |
+-----------------+
```

##### RIGHT()

选取字符串右侧n位字符

```
mysql> SELECT RIGHT('MySQL',3);
+------------------+
| RIGHT('MySQL',3) |
+------------------+
| SQL              |
+------------------+
```

函数嵌套使用：

```
 mysql> SELECT UPPER(CONCAT(LEFT('MySQL',2),RIGHT('MySQL',3))) AS FULL;
+-------+
| FULL  |
+-------+
| MYSQL |
+-------+
```

##### LENGTH()

返回字符串长度

```
mysql> SELECT LENGTH('GHHJK%^  &G ');
+------------------------+
| LENGTH('GHHJK%^  &G ') |
+------------------------+
|                     12 |
+------------------------+
```

##### LTRIM()

删除前导空格

```
mysql> SELECT LTRIM('   MySQL   ');
+----------------------+
| LTRIM('   MySQL   ') |
+----------------------+
| MySQL                |
+----------------------+
mysql> SELECT LENGTH(LTRIM('   MySQL   '));
+------------------------------+
| LENGTH(LTRIM('   MySQL   ')) |
+------------------------------+
|                            8 |
+------------------------------+
```

##### RTRIM()

删除后导空格

```
mysql> SELECT RTRIM('   MySQL   ');
+----------------------+
| RTRIM('   MySQL   ') |
+----------------------+
|    MySQL             |
+----------------------+
mysql> SELECT LENGTH(RTRIM('   MySQL   '));
+------------------------------+
| LENGTH(RTRIM('   MySQL   ')) |
+------------------------------+
|                            8 |
+------------------------------+
```

##### TRIM()

删除前后导字符或特定字符：

```
mysql> SELECT TRIM('   MySQL   ');
+---------------------+
| TRIM('   MySQL   ') |
+---------------------+
| MySQL               |
+---------------------+
mysql> SELECT LENGTH(TRIM('   MySQL   '));
+-----------------------------+
| LENGTH(TRIM('   MySQL   ')) |
+-----------------------------+
|                           5 |
+-----------------------------+
```

从字符串中删除前导的某字符：

```
mysql> SELECT TRIM(LEADING '?' FROM '??MySQL???');
+-------------------------------------+
| TRIM(LEADING '?' FROM '??MySQL???') |
+-------------------------------------+
| MySQL???                            |
+-------------------------------------+
```

从字符串中删除后导的某字符：

```
mysql> SELECT TRIM(TRAILING '?' FROM '??MySQL???');
+--------------------------------------+
| TRIM(TRAILING '?' FROM '??MySQL???') |
+--------------------------------------+
| ??MySQL                              |
+--------------------------------------+
```

从字符串中删除前导及后导的某字符：

```
mysql> SELECT TRIM(BOTH '?' FROM '??MySQL???');
+----------------------------------+
| TRIM(BOTH '?' FROM '??MySQL???') |
+----------------------------------+
| MySQL                            |
+----------------------------------+
```

##### REPLACE()

替换字符串中的某字符：

```
mysql> SELECT REPLACE('??My???SQL???','?','');
+---------------------------------+
| REPLACE('??My???SQL???','?','') |
+---------------------------------+
| MySQL                           |
+---------------------------------+
```

##### SUBTRING()

包含三个参数：字符串、从第几位开始截取、共截取几位。

MySQL中，字符下标从1开始计数。

第二个参数可以为负，表示从倒数第几位起截取。

省略第三个参数，则截取至尾部。

```
mysql> SELECT SUBSTRING('MySQL',3,2);
+------------------------+
| SUBSTRING('MySQL',3,2) |
+------------------------+
| SQ                     |
+------------------------+
mysql> SELECT SUBSTRING('MySQL',3);
+----------------------+
| SUBSTRING('MySQL',3) |
+----------------------+
| SQL                  |
+----------------------+
mysql> SELECT SUBSTRING('MySQL',-2);
+-----------------------+
| SUBSTRING('MySQL',-2) |
+-----------------------+
| QL                    |
+-----------------------+
```

##### [NOT]LIKE

模式匹配：

%表示匹配任意个字符（0,1或多个）

_表示匹配一个字符

```
mysql> SELECT 'MySQL' LIKE 'M%';
+-------------------+
| 'MySQL' LIKE 'M%' |
+-------------------+
|                 1 |
+-------------------+
```

```
mysql> SELECT * FROM test2 WHERE first_name LIKE '%o%';
+------------+-----------+
| first_name | last_name |
+------------+-----------+
| tom%       | 123       |
+------------+-----------+
```

```
mysql> SELECT 'MySQL' LIKE 'M_S_L';
+----------------------+
| 'MySQL' LIKE 'M_S_L' |
+----------------------+
|                    1 |
+----------------------+
```

```
mysql> SELECT * FROM test2 WHERE first_name LIKE '%\%';
+------------+-----------+
| first_name | last_name |
+------------+-----------+
| tom%       | 123       |
+------------+-----------+
```

也可以用任意字符来取代'\',使通配符表示字符本义：

```
mysql> SELECT * FROM test2 WHERE first_name LIKE '%1%%' ESCAPE '1';
+------------+-----------+
| first_name | last_name |
+------------+-----------+
| tom%       | 123       |
+------------+-----------+
```

#### 数值运算符和函数

##### CEIL() 

向上取整

##### FLOOR()

向下取整

##### ROUND()

四舍五入

```
mysql> SELECT ROUND(3.784,1);
+----------------+
| ROUND(3.784,1) |
+----------------+
|            3.8 |
+----------------+
```

##### DIV

整除

##### MOD

取模（也可以用 ’%‘）

##### POWER()

幂运算

```
mysql> SELECT POWER(3,3);
+------------+
| POWER(3,3) |
+------------+
|         27 |
+------------+
```

##### TRUNCATE()

数字截断

```
mysql> SELECT TRUNCATE(123.56,1);
+--------------------+
| TRUNCATE(123.56,1) |
+--------------------+
|              123.5 |
+--------------------+
mysql> SELECT TRUNCATE(123.56,-1);
+---------------------+
| TRUNCATE(123.56,-1) |
+---------------------+
|                 120 |
+---------------------+
```

#### 比较运算符与函数

##### [NOT] BETWEEN...AND...

````
mysql> SELECT 15 BETWEEN 1 AND 15;
+---------------------+
| 15 BETWEEN 1 AND 15 |
+---------------------+
|                   1 |
+---------------------+
````

##### [NOT] IN()

```
mysql> SELECT 15 IN (1,5,10);
+----------------+
| 15 IN (1,5,10) |
+----------------+
|              0 |
+----------------+
```

##### IS [NOT] NULL

```
mysql> SELECT NULL IS NULL;
+--------------+
| NULL IS NULL |
+--------------+
|            1 |
+--------------+
```

```
mysql> SELECT '' IS NULL;
+------------+
| '' IS NULL |
+------------+
|          0 |
+------------+
```

```
mysql> SELECT * FROM test2 WHERE first_name IS NULL;
+------------+-----------+
| first_name | last_name |
+------------+-----------+
| NULL       | 11        |
+------------+-----------+
```

```
mysql> SELECT * FROM test2 WHERE first_name IS NOT NULL;
+------------+-----------+
| first_name | last_name |
+------------+-----------+
| A          | B         |
| C          | D         |
| tom%       | 123       |
+------------+-----------+
```

#### 日期时间函数（实际开发中不常用）

##### NOW()

当前日期时间

```
mysql> SELECT NOW();
+---------------------+
| NOW()               |
+---------------------+
| 2017-04-26 15:41:10 |
+---------------------+
```

##### CURDATE()

当前日期

```
mysql> SELECT CURDATE();
+------------+
| CURDATE()  |
+------------+
| 2017-04-26 |
```

##### CURTIME()

当前时间

```
mysql> SELECT CURTIME();
+-----------+
| CURTIME() |
+-----------+
| 15:41:38  |
+-----------+
```

##### DATE_ADD()

当前日期变化（添加或减少）

```
mysql> SELECT DATE_ADD(CURDATE(),INTERVAL 365 DAY);
+--------------------------------------+
| DATE_ADD(CURDATE(),INTERVAL 365 DAY) |
+--------------------------------------+
| 2018-04-26                           |
+--------------------------------------+
mysql> SELECT DATE_ADD(CURDATE(),INTERVAL -365 DAY);
+---------------------------------------+
| DATE_ADD(CURDATE(),INTERVAL -365 DAY) |
+---------------------------------------+
| 2016-04-26                            |
+---------------------------------------+
mysql> SELECT DATE_ADD(CURDATE(),INTERVAL 3 WEEK);
+-------------------------------------+
| DATE_ADD(CURDATE(),INTERVAL 3 WEEK) |
+-------------------------------------+
| 2017-05-17                          |
+-------------------------------------+
mysql> SELECT DATE_ADD(CURDATE(),INTERVAL 4 MONTH);
+--------------------------------------+
| DATE_ADD(CURDATE(),INTERVAL 4 MONTH) |
+--------------------------------------+
| 2017-08-26                           |
+--------------------------------------+
```

##### DATEDIFF()

计算日期差值

```
mysql> SELECT DATEDIFF('2017-5-12','2017-2-15');
+-----------------------------------+
| DATEDIFF('2017-5-12','2017-2-15') |
+-----------------------------------+
|                                86 |
+-----------------------------------+
```

##### DATE_FORMAT()

日期格式化

```
mysql> SELECT DATE_FORMAT(CURDATE(),'%m/%d/%Y');
+-----------------------------------+
| DATE_FORMAT(CURDATE(),'%m/%d/%Y') |
+-----------------------------------+
| 04/26/2017                        |
+-----------------------------------+
```

#### 信息函数

##### CONNECTION_ID()

当前连接MySQL服务的线程ID

```
mysql> SELECT CONNECTION_ID();
+-----------------+
| CONNECTION_ID() |
+-----------------+
|               3 |
```

##### DATABASE()

当前数据库

```
mysql> SELECT DATABASE();
+------------+
| DATABASE() |
+------------+
| lcyDB      |
+------------+
```

##### USER()

当前用户

```
mysql> SELECT USER();
+----------------+
| USER()         |
+----------------+
| root@localhost |
+----------------+
```

##### VERSION()

版本信息

```
mysql> SELECT VERSION();
+-----------+
| VERSION() |
+-----------+
| 5.7.15-1  |
+-----------+
```

LAST_INSERT_ID()

最后插入记录的ID号

先在表中加入ID字段：

```
mysql> ALTER TABLE test2 ADD 
    -> id SMALLINT UNSIGNED PRIMARY KEY AUTO_INCREMENT FIRST;
```

添加一条新纪录：

```
mysql> INSERT test2 VALUES(DEFAULT,'Lee','CY');
```

查看最新插入记录的ID：

```
mysql> SELECT LAST_INSERT_ID();
+------------------+
| LAST_INSERT_ID() |
+------------------+
|                5 |
+------------------
```

同时插入多条，返回新插入的第一条ID

```
mysql> INSERT test2 VALUES(DEFAULT,'Lee','CY'),(DEFAULT,'YYY','FFFF');
mysql> SELECT LAST_INSERT_ID();
+------------------+
| LAST_INSERT_ID() |
+------------------+
|                6 |
+------------------+
```

#### 聚合函数

特点：用于数据表中的数据，仅有一个返回值。

##### AVG()

均值

```
mysql> SELECT ROUND(AVG(goods_price),2) FROM tdb_goods;
+---------------------------+
| ROUND(AVG(goods_price),2) |
+---------------------------+
|                   5845.10 |
+---------------------------+
```

##### COUNT()

计数

```
mysql> SELECT COUNT(goods_id) FROM tdb_goods;
+-----------------+
| COUNT(goods_id) |
+-----------------+
|              20 |
+-----------------+
```

##### MAX()

最大值

```
mysql> SELECT MAX(goods_price) FROM tdb_goods;
+------------------+
| MAX(goods_price) |
+------------------+
|        28888.000 |
+------------------+
```

##### MIN()

最小值

##### SUM()

求和

#### 加密函数

##### MD5()

信息摘要算法

```
mysql> SELECT MD5('MySQL');
+----------------------------------+
| MD5('MySQL')                     |
+----------------------------------+
| 62a004b95946bb97541afa471dcca73a |
+----------------------------------+
```

多用于Web页面。

##### PASSWORD()

密码算法 （可以用于修改当前用户密码）

```
mysql> SET PASSWORD=PASSWORD('root');
```